\chapter{Weather data}
\label{ch:weather_data}

Based on the insights acquired from existing work in chapter~\ref{ch:existing_work}, this chapter aims at compiling a set of data elements about the weather which are either necessary for providing useful data to the \thinkhome system or which would add benefit to the data provided. Furthermore, possible sources are evaluated with respect to their suitability for the given context.

% TODO cite this section in thinkhomeweather_ontology.tex
\section{Weather information}
\label{sec:weather_information}

In order to identify which data is required for the \thinkhome ontology (\thinkhomeweather), it is necessary to define the scope that shall be covered by the ontology. When designing an ontology, requirements analysis is often centered around a set of \emph{competency questions}\cite{Ontology101,UscholdKing,GruningerFox,Methontology}. If the ontology is able to provide answers to all of these competency questions, its requirements are met.

Below are the questions that have been identified to be adequate competency questions for \thinkhomeweather; the list stems from analysis of the processes at a \smarthome that may be influenced by weather.

\begin{itemize}
  \item What is the current weather situation?
  \item What will the weather situation be in one hour, in two hours, …, in 24 hours?
  \item What is the current temperature, humidity, wind speed, …?
  \item What will be the temperature, humidity, wind speed, … in one hour, in two hours, …, in 24 hours?
  \item What will be the minimum temperature, humidity, … over the next 24 hours? What about maximum values?
  \item Will the weather change? Will the temperature, humidity, … rise or fall?
  \item Does it rain? Will it rain in the next hours? Will it rain today?
  \item Will there be sunshine today? 
  \item Do we need to irrigate the garden?
  \item Will there be severe weather?
  \item Will temperature drop/stay below \SI{0}{\celsius}?
  \item When can we open windows and when do we have to keep them shut?
  \item When do we need sun protection?
  \item When will it outside be colder than inside the house? When will it be warmer?
\end{itemize}

These competency questions will again be used in section~\ref{sec:ontology_specification} when the \emph{Ontology requirements specification document} is created.

The idea of providing \thinkhome with future weather data is to enable \thinkhome to prepare for upcoming weather situations. There are Internet weather services that provide forecasts for several days (see section~\ref{sec:internet_services}). However, the further the time described by a forecast lies in the future, the more inaccurate the forecast becomes\cite{forecast_error1,forecast_error2}. Additionally, no decisions in a \smarthome have been identified that require the availability of a forecast about a time more than a few hours in the future. Hence, the period of 24 hours has been chosen as a compromise between the deteriorating accuracy of weather forecasts over time and the time period \thinkhome requires weather data for.

The above competency questions can be answered when the (predicted) state of the weather for particular points of time is known. The state of the weather is given by measurement values of certain \emph{weather elements}. These weather elements are temperature, relative and absolute humidity, dew point temperature, wind speed, wind direction, precipitation, cloud coverage and others.\cite{GlossaryOfMeteorology}

A set of measurement value for one or more points of time is called \emph{weather state} from now on.

Apart from weather elements, Internet weather services often provide some information that will be called \emph{weather condition} from now on. Generally speaking, the weather condition is what someone tells you if you ask her about the current weather situation. Examples for the overall weather condition are ``Sun'', ``Rain'', and ``Fog''. Some weather conditions can be split up into several conditions, e.g. ``It is overcast and raining'' into ``Overcast'' and ``Rain''.

Sources for weather data are weather sensors and weather forecasts. As \thinkhome performs no weather forecasting on its own, forecast data is gathered from weather services via Internet. While data about the current weather state can be obtained from both weather sensors and Internet services, the only source for data about future weather states are Internet services.

However, there there are weather elements no sensor can provide data about, and there are weather elements that are not available from any of the Internet services presented in section~\ref{sec:weather_services}. Section~\ref{sec:weather_sensors} covers data that can be obtained from weather sensors; section~\ref{sec:weather_services} discusses weather data that can be fetched from Internet services. Based on the findings in these two sections, \ref{sec:weather_conclusion} presents a set of weather elements that are incorporated into \thinkhomeweather.

\section{Sensor data}
\label{sec:weather_sensors}

While there are stand-alone solutions for fetching weather data from sensors, in many \emph{home automation} systems \emph{fieldbus} systems are used.

\subsection{\emph{Fieldbus} systems}
\label{sec:fieldbus}

Over the past few years, several of \emph{fieldbus} systems have emerged in the context of \emph{home automation}. A \emph{fieldbus} is a network system for real-time distributed control\cite{fieldbus}, standardised as \emph{IEC~61158}\cite{IEC61158}. A \emph{Programmable Logic Controller} (\eacs{PLC}), a computer which is designed specifically for automation purposes, can utilize a \emph{fieldbus} to retrieve sensor data from \emph{sensors} and send control commands to \emph{actuators}. Among the sensors that are available for \emph{fieldbus} systems, there exist sensors for a wide variety of weather elements such as temperature or humidity. 

There are several competing standards for \emph{fieldbus} systems, including:
\begin{itemize}
  \item \textbf{Bitbus:} \emph{Bitbus}, created in 1983 by \emph{Intel Corporation}, is the oldest \emph{fieldbus}. In 1991, it was approved as an international standard as \emph{IEEE~1118}\cite{IEEE1118}. It employs \emph{twisted pair} cabling for connecting its components.
  
  \item \textbf{KNX:} \emph{KNX} is an international standard (\emph{ISO/IEC 14543-3}\cite{knx,knx_standard}) which is the successor to three previously used \emph{fieldbus} systems, namely \emph{European Home Systems Protocol} (\eacs{EHS}), \emph{BatiBUS} and \emph{European Installation Bus} (\eacs{EIB}). It supports the use of several physical communication media such as \emph{twisted pair} wiring, \emph{power line} networking, \emph{Ethernet}, \emph{infrared} or \emph{radio}. There is a wide range of devices that can be used for controlling a \emph{KNX} network.
  
  \item \textbf{LonWorks:} Developed by \emph{Echelon Corporation}~\cite{echelon} in 1990, \emph{LonWorks} (\emph{Local Operating Network})~\cite{lonworks} is a widely used fieldbus standard; since 2008, the technology is standardised as \emph{ISO/IEC~14908}\cite{ISO14908}. \emph{LonWorks} supports \emph{twisted pair} cabling and \emph{power line} networking and can be controlled by any general-purpose processor which can use the \emph{LonTalk} protocol that is employed by \emph{LonWorks}.
  
  \item \textbf{BACnet:} \eacs{BACnet} (\emph{building automation and control networks})~\cite{bacnet} is another communications protocol which is internationally standardised in \emph{ISO~16484-5}\cite{ISO16484}. It employs several communication means such as \emph{Ethernet}, \emph{BACnet/IP}, \emph{Point-to-point connections} over \emph{RS-232} or \emph{LonWorks}' \emph{LonTalk}.
  
  \item \textbf{LCN:} \eacs{LCN} (\emph{Local Control Network})~\cite{LCN} is a proprietary home automation system developed by \emph{Issendorf KG} in 1992. \eacs{LCN} is organised into \emph{\eacs{LCN} modules} that exchange data over a single data wire and the neutral wire power supply.
\end{itemize}

\subsection{\emph{KNX} sensors}

Each of the \emph{fieldbus} systems mentioned in section~\ref{sec:fieldbus} provides a variety of sensors. \emph{KNX}, which is an open standard, is used in this section as an example to enumerate the weather sensors that are available for \emph{fieldbus} systems.

\emph{KNX} weather sensors are available for
\begin{itemize}
  \item atmospheric pressure (\emph{barometer}),
  \item brightness (\emph{photometer}), % TODO mention in later section: use solar radiation, do not use brightness
  \item humidity (\emph{hygrometer}),
  \item precipitation (\emph{rain gauge}),
  \item solar radiation (\emph{pyranometer)},
  \item temperature (\emph{thermometer}), and
  \item wind direction and wind speed (\emph{wind vane} and \emph{anemometer}, respectively).
\end{itemize}

There are \emph{weather stations} that provide sensors for a combinations of the above weather elements.

Other sensors that are available under the \emph{KNX} standard include sensors for water, fluid level, smoke or \ce{CO2} concentration. However, these are not relevant in the context of \thinkhomeweather as they do not provide weather data.


\section{Service data}
\label{sec:weather_services}

This section digs into the details of a number of popular weather services that are available over the Internet. In a first step, a number of aspects are identified that are relevant for the use of a weather service in the context of \thinkhome. The weather services are then evaluated regarding these aspects.

\subsection{Available Internet services}
\label{sec:internet_services}

There is a tremendous amount of services providing weather data over the Internet\footnote{No website has been found that compiles a comprehensive list of Internet weather services; however, there are many websites that discuss various services~\cite{WeatherServices1,WeatherServices2,WeatherServices3}}. However, only a small number of these services is suitable for use in a context as in can be found \thinkhome. The services differ regarding the way data is provided, the data format, the area being covered, the terms of use etc.

The access to Internet weather services in \thinkhome is implemented in Java, hence an important question about a certain weather service is whether in can easily be accessed from within a Java program.

For evaluation of Internet weather services, the following aspects are examined:

\begin{itemize}
  \item \textbf{Coverage area:} Which part of the world is covered by the weather service?\\
  In order to keep things simple, a service covering a larger part of the world is preferred over a service covering a smaller part.
  
  \item \textbf{Data format:} In what format is weather data being delivered? Can it be easily parsed and processed?\\
  A data format that is easier to handle on client-side is preferred over a data format that requires more complicated handling. While \eacs{XML}\cite{XML} can be handled natively within many programming languages including Java (using \eacs{DOM}~\cite{DOM} or \eacs{SAX}~\cite{SAX}, \eacs{JSON}~\cite{rfc4627} may require an additional library in some languages such as Java\footnote{\eacs{JSON} libraries for Java include \emph{JSON-lib}~\cite{json-lib}, \emph{FlexJSON}~\cite{flexjson} and \emph{Gson}~\cite{gson}}, while \emph{PHP} comes with built-in support for \eacs{JSON}~\cite{php-json}. There may even be data formats that require the development of a new parser.
  
  \item \textbf{Data access:} How does the access to weather data work? How is data requested and how is the answer being received?\\
  The less complicated a request is, the better the service suits the requirements. Requests in \eacs{HTTP}~\cite{rfc2616} are preferred due to the simplicity of performing requests on the client side in Java using the \emph{Apache HttpComponents project}~\cite{apache_hc}.
  
  \item \textbf{Access restrictions, terms of use:} Is the service available freely or is the access restricted? Are credentials (e.g. a username and a password or an access key) required for access? If yes, can the credentials be obtained in a simple way or does that entail a complicated procedure? Are there any access fees for academic or commercial use?\\
  A service being less restricted is preferred over a service coming with more restrictions.
  
  \item \textbf{Documentation:} Is there any documentation for this service? Does it cover all aspects or are there some features that are undocumented?\\
  Of course, a service without documentation is unsuitable. A better documented service is always preferred over a service that is less documented.
  
  \item \textbf{Stability:} Can one expect the service to remain unchanged over a reasonable amount of time (e.g. several years)? If there will be future changes, will they be announced? How long will they be announced in advance?\\
  A stable service is preferred over an unstable one. A better handling of changes is preferred over a worse handling of changes.
  
  \item \textbf{Weather elements:} Which weather elements (e.g. temperature, relative humidity, dew point etc.) are covered by the service?\\
  A weather service covering a wider range of weather elements is preferred over a service covering a smaller range.
  
  \item \textbf{Time frame:} Are forecasts available? If yes, how detailed are these forecasts? How far into the future are forecasts available? What is the interval between two forecasts?\\
  Forecasts for at least 48 hours are mandatory. Over the next 48 hours, there should be at least six forecasts with an interval of at most eight hours between two consecutive forecasts. A weather service covering a longer period than 48 hours into the future and/or more than six forecasts within the next 48 hours is preferred.
  
  \item \textbf{Weather updates:} How often is the weather data being updated?\\
  The data should be updated at least every six hours. A service having a shorter update interval is preferred over a service having a longer interval.
\end{itemize}

In the following sections, some of the most popular Internet weather services are evaluated. There may be other services that are popular as well while some of the services covered here may actually be not popular at all. The selection is just a set of services that seemed to be popular at the time the evaluation was performed.

In addition to the aspects listed above, some general information is provided (operator and web page). The following sections aim at determining which Internet weather service best fits the given requirements. Furthermore, based on which weather elements are provided by various services, a set of weather elements is determined that will be used in the ontology. Including weather elements that are not available from any weather services are useless.

\paragraph{Weather services being evaluated}

% TODO link to DWD?
Table~\ref{table:weather_data1} lists all weather services that have been evaluated together with their operators, web pages and coverage areas. \emph{Google Weather API} is discontinued~\cite{google_weather}; it is included here because \emph{Google} announced its shutdown after the time this evaluation was conducted. The \emph{Google Weather API} serves as an example of a weather service that is unsuitable for usage in \thinkhomeweather as it is discontinued. \eacs{DWD} and \emph{Weather Underground} are the only services that do not provide worldwide data.

Table~\ref{table:weather_data3} lists all weather services together with the data format they use to provide their data. For the case of Java, \eacs{XML}-based formats including \eacs{RSS} feeds are preferred because of the built-in support for \eacs{XML} by \eacs{DOM} and \eacs{SAX}. There are libraries for providing \eacs{JSON} and \eacs{JSONP}~\cite{jsonp} support for Java. \eacs{CSV} (\emph{comma-separated values})~\cite{rfc4180} is a format that can be parsed easily in any language, although using \eacs{CSV} leads to more implementation costs than \eacs{XML}. There are no libraries available that provide Java support for the \eacs{SYNOP} format (\emph{Surface Synoptic Observations}~\cite{SYNOP} which is used by \eacs{DWD}; hence this format is unsuitable to be used in a Java application.

\eacs{METAR} is a format for reporting weather data~\cite{metar} that is standardised by the \emph{International Civil Aviation Organisation} (\eacs{ICAO})~\cite{ICAO}. It is primarily used in aviation to provide weather data to pilots of aircraft. There are a few parsers available, e.g. \emph{PyMETAR}~\cite{pymetar} for Python or an implementation for Java~\cite{metar-java}.

% TODO NWS, METAR, Weather.com
Regarding the terms of use that are summarized in table~\ref{table:weather_data4}, there are some services that require the creation of an account (\eacs{DWD}, \emph{World Weather Online}, \emph{Weather Underground}, and \emph{Weather.com}) while others don't (\emph{Yahoo! Weather}, \emph{Google Weather Feed}, \yrno, and \eacs{METAR}). Some services provide all of their data freely (\eacs{DWD}, \yrno), others provide the data freely only for non-commercial purposes (\emph{Yahoo! Weather}, \emph{World Weather Online}, and \emph{Weather Underground}); for some services, the terms of use are unknown (\emph{Google Weather Feed}).

Except the ones not providing information about changes (\emph{Yahoo! Weather}, \emph{World Weather Online}, \emph{Weather Underground} and \emph{Weather.com}) and the one being discontinued (\emph{Google Weather Feed}), all weather services declare to perform regular updates to their weather services (see table~\ref{table:weather_data5}). Any changes are announced either on the web pages, via \eacs{RSS} feeds or via email.

% TODO NWS
Table~\ref{table:weather_data6} shows which data is available from the weather services. While temperature is available from all services, some services provide only data about a few other weather elements (\emph{Google Weather Feed} and \emph{Weather Underground}); from some services, only limited forecasts are available (\eacs{DWD}, \emph{Yahoo! Weather}, and \emph{World Weather Online}, \emph{Weather.com}). Some services limit the availability of data via their freely accessible interface (\emph{World Weather Online} and \emph{Weather Underground}).

% TODO NWS
As seen in table~\ref{table:weather_data7}, \eacs{METAR}s only provide current weather data; some services provide forecasts for several days, but give only one forecast per day (\emph{Yahoo! Weather}, \emph{Google Weather Feed}, and \emph{Weather Underground}). All weather services provide frequent updates (at least every few hours).

\begin{table}
\centering
\begin{threeparttable}[b]
\begin{tabular}{|p{.2\textwidth}|p{.3\textwidth}|p{0.1\textwidth}|p{0.25\textwidth}|}
  \hline
  \textbf{Name} & \textbf{Operator} & \textbf{Web page} & \textbf{Coverage area} \\
  \hline\hline
  \textbf{DWD} & Deutscher Wetterdienst (\eacs{DWD}, ``German weather service'') & \cite{dwd} & Worldwide (current weather data); Germany and large cities around the world (forecasts)  \\
  \hline
  \textbf{Yahoo! Weather} & Yahoo! Inc. & \cite{yahoo_weather} & Worldwide  \\
  \hline
  \textbf{World Weather Online} & World Weather Online & \cite{worldweatheronline} & Worldwide  \\
  \hline
  \textbf{Google Weather Feed} & Google Inc. & none\tnote{1} & Worldwide  \\
  \hline
  \textbf{yr.no} & Meteorologisk institutt (Norwegian Meteorological Institute), Norsk rikskringkasting AS (NRK, Norwegian Broadcasting Corporation) & & Worldwide \\
  \hline
  \textbf{\acs{METAR}} & Airports around the world & \cite{metar_source} & Worldwide \\ % TODO correct?
  \hline
  \textbf{\acs{NWS}} & National Weather Service\tnote{2} & \cite{nws} & Only US \\
  \hline
  \textbf{Weather Underground} & Weather Underground & \cite{weather_underground} & Worldwide \\
  \hline
  \textbf{Weather.com} & The Weather Channel, LLC & ~\cite{weather_com} & Worldwide \\
  \hline
\end{tabular}
\begin{tablenotes}
\item[1] not publicly advertised API
\item[2] part of \eacs{NOAA} (\emph{National Oceanic and Atmospheric Administration})~\cite{noaa}
\end{tablenotes}
\end{threeparttable}
\vspace{.5em}
\caption{Names, operators, web pages, and coverage areas of all weather services that have been evaluated.}
\label{table:weather_data1}
\end{table}

\begin{comment}
\begin{table}
\centering
\begin{tabular}{|p{.2\textwidth}|p{0.35\textwidth}|}
  \hline
  \textbf{Name} & \textbf{Coverage area} \\
  \hline\hline
  \textbf{DWD} & Worldwide (current weather data); Germany and large cities around the world (forecasts) \\
  \hline
  \textbf{Yahoo! Weather} & Worldwide \\
  \hline
  \textbf{World Weather Online} & Worldwide \\
  \hline
  \textbf{Google Weather Feed} & Worldwide \\
  \hline
  \textbf{yr.no} & Worldwide \\
  \hline
  \textbf{\acs{METAR}} & Worldwide \\
  \hline
  \textbf{\acs{NWS}} & Only US \\
  \hline
  \textbf{Weather Underground} & Worldwide \\
  \hline
  \textbf{Weather.com} & Worldwide \\
  \hline
\end{tabular}
\vspace{.5em}
\caption{Coverage areas of weather services.}
\label{table:weather_data2}
\end{table}
\end{comment}

\begin{table}
\centering
\begin{tabular}{|p{.2\textwidth}|p{.3\textwidth}|p{0.35\textwidth}|}
  \hline
  \textbf{Name} & \textbf{Data format} & \textbf{Data access} \\
  \hline\hline
  \textbf{DWD} & \eacs{SYNOP} (current weather data); not machine-readable weather maps, tables and texts (forecasts) & \eacs{FTP}\cite{rfc959} \\
  \hline
  \textbf{Yahoo! Weather} & \eacs{RSS} feed & \eacs{HTTP} \\
  \hline
  \textbf{World Weather Online} & \eacs{XML}, \eacs{JSON}, \eacs{JSONP}, \eacs{CSV} & \eacs{HTTP} \\
  \hline
  \textbf{Google Weather Feed} & \eacs{XML} & \eacs{HTTP} \\
  \hline
  \textbf{yr.no} & \eacs{XML} & \eacs{HTTP} \\
  \hline
  \textbf{\acs{METAR}} & Format standardised by \eacs{ICAO}; not human-readable. & Via HTML from \eacs{NOAA}'s web page\tnote{2} (\emph{National Oceanic and Atmospheric Administration}). Various other data sources are available. \\
  \hline
  \textbf{\acs{NWS}} & \eacs{XML} & \eacs{SOAP}\cite{SOAP}, \eacs{REST}\cite{REST} \\
  \hline
  \textbf{Weather Underground} & \eacs{JSON}, \eacs{XML} & \eacs{HTTP} \\
  \hline
  \textbf{Weather.com} & \eacs{JSON}, \eacs{XML} & \eacs{HTTP} \\
  \hline
\end{tabular}
\vspace{.5em} % TODO remove this?
\caption{Data formats and protocols for data access of weather services.}
\label{table:weather_data3}
\end{table}

\begin{table}
\centering
\begin{tabular}{|p{.2\textwidth}|p{0.35\textwidth}|}
  \hline
  \textbf{Name} & \textbf{Access restrictions, terms of use} \\
  \hline\hline
  \textbf{DWD} & An account is mandatory for access. Account creation is a matter of minutes and new accounts do not need to be approved by DWD. The use of DWD is free for use within projects like \thinkhome.\\
  \hline
  \textbf{Yahoo! Weather} & Free for use for individuals and non-profit organizations, attribution required. No statement about commercial use anywhere in the documentation.\\
  \hline
  \textbf{World Weather Online} & An account must be created for accessing both the Free API and the Premium API. The Free API is free to use for personal and commercial use, credits must be given to World Weather Online. Costs for the Premium API start at 20 US dollars per month.\\
  \hline
  \textbf{Google Weather Feed} & No account required; terms of use unknown (does not have an explicitely stated licence due to being an inofficial interface) \\
  \hline
  \textbf{yr.no} & No account required; data licenced under \emph{CC-BY 3.0}~\cite{ccby30}\\
  \hline
  \textbf{\acs{METAR}} & Unknown \\ % TODO ?
  \hline
  \textbf{\acs{NWS}} & \\ % TODO
  \hline
  \textbf{Weather Underground} & Account creation is mandatory; available for personal, non-commercial use (public API); custom weather services are available \\
  \hline
  \textbf{Weather.com} & An account is mandatory; the creation process is complicated \\ % TODO licence?
  \hline
\end{tabular}
\vspace{.5em}
\caption{Access restrictions and terms of use for weather services.}
\label{table:weather_data4}
\end{table}

\begin{table}
\centering
\begin{threeparttable}[b]
\begin{tabular}{|p{.2\textwidth}|p{0.35\textwidth}|}
  \hline
  \textbf{Name} & \textbf{Stability} \\
  \hline\hline
  \textbf{DWD} & A few changes every weeks which are announced via email at least one week in advance; data required by \thinkhome has never been changed during the last six months.\\
  \hline
  \textbf{Yahoo! Weather} & Unknown \\
  \hline
  \textbf{World Weather Online} & Unknown \\
  \hline
  \textbf{Google Weather Feed} & Discontinued~\cite{google_weather} \\
  \hline
  \textbf{yr.no} & New releases of the API one or two times per year; the old API remains in operation a few months after the release of a new one. Announcements are made on the web page. A less frequently changing API with \emph{long term support} is available.\\
  \hline
  \textbf{\acs{METAR}} & Stable.\tnote{1} \\
  \hline
  \textbf{\acs{NWS}} & Small changes every few months with announcements via \eacs{RSS}. Most of the interface remains unchanged in the long run.\\
  \hline
  \textbf{Weather Underground} & The has been a recent API change; the stability is unknown. \\
  \hline
  \textbf{Weather.com} & Unknown \\
  \hline
\end{tabular}
\begin{tablenotes}
\item[1] \emph{METAR} is standardized by \eacs{ICAO}~\cite{ICAO}. It was introduced in 1968 and has been modified a numer of times since. However, most elements remained the same since introduction and can be expected to remain unchanged in the long run.
\end{tablenotes}
\end{threeparttable}
\vspace{.5em}
\caption{Stability of weather services.}
\label{table:weather_data5}
\end{table}

\begin{table}
\centering
\begin{tabular}{|p{.2\textwidth}|p{0.35\textwidth}|}
  \hline
  \textbf{Name} & \textbf{Weather elements} \\
  \hline\hline
  \textbf{DWD} & Temperature, relative humidity, wind speed and direction, precipitation, atmospheric pressure, cloud coverage (current weather). Temperature and weather condition (forecasts).\\
  \hline
  \textbf{Yahoo! Weather} & Temperature, wind chill, speed and direction, relative humidity, visibility, atmospheric pressure, sunrise, and sunset times (current weather). Temperature and weather condition (forecast).\\
  \hline
  \textbf{World Weather Online} & Temperature, wind speed and direction, relative humidity, and precipitation intensity (Free API). Additionally dew point, chance of precipitation and atmospheric pressure (forecast).\\
  \hline
  \textbf{Google Weather Feed} & Temperature, humidity (only current weather), weather condition.\\
  \hline
  \textbf{yr.no} & Temperature, wind direction and speed, chance and intensity of precipitation, atmospheric pressure, relative humidity, cloud coverage, fog.\\
  \hline
  \textbf{\acs{METAR}} & Temperature, dew point, wind speed and direction, precipitation, cloud coverage, visibility, and atmospheric pressure. \\
  \hline
  \textbf{\acs{NWS}} & \\ % TODO
  \hline
  \textbf{Weather Underground} & Minimum and maximum temperature, weather condition (public API); more data via custom weather services \\
  \hline
  \textbf{Weather.com} & Temperature, humidity, precipitation, wind speed and direction, sunrise and sunset times, and the weather condition (current weather and forecasts); atmospheric pressure, visibility, and dew point (current weather only) \\
  \hline
\end{tabular}
\vspace{.5em}
\caption{Weather elements provided by weather services.}
\label{table:weather_data6}
\end{table}

\begin{table}
\centering
\begin{tabular}{|p{.2\textwidth}|p{.3\textwidth}|p{0.35\textwidth}|}
  \hline
  \textbf{Name} & \textbf{Time frame} & \textbf{Weather updates} \\
  \hline\hline
  \textbf{DWD} & 72 hours & Every few hours \\
  \hline
  \textbf{Yahoo! Weather} & 48 hours (only one forecast per day) & Every few hours \\
  \hline
  \textbf{World Weather Online} & Five days & Every \num{3} to \num{4} hours \\
  \hline
  \textbf{Google Weather Feed} & 72 hours (only one forecast per day) & Every few hours \\
  \hline
  \textbf{yr.no} & Nine days (four forecasts per day) & Every few hours \\
  \hline
  \textbf{\acs{METAR}} & Only current weather data & Once per hour \\
  \hline
  \textbf{\acs{NWS}} & ? & About once per hour \\ % TODO
  \hline
  \textbf{Weather Underground} & Five days (one forecast per day) & Every few hours \\
  \hline
  \textbf{Weather.com} & Five days & Every few hours \\
  \hline
\end{tabular}
\vspace{.5em}
\caption{Time frame of forecast data and frequency of weather updates at weather services.}
\label{table:weather_data7}
\end{table}

% TODO documentation

\begin{comment}
% TODO

DWD:
  \item \textbf{Data format:} Current weather data is available in SYNOP format (Surface Synoptic Observations) \footnote{\href{http://weather.unisys.com/wxp/Appendices/Formats/SYNOP.html}{http://weather.unisys.com/wxp/Appendices/Formats/SYNOP.html}}. A Java parser may be time-consuming to implement. Forecasts are available as weather maps, tables and text (not machine-readable).

  \item \textbf{Data access:} Via FTP (supported in Java by the Apache HttpComponents project\footnote{\href{http://hc.apache.org/}{http://hc.apache.org/}}).








\paragraph{DWD}

\begin{itemize}
  \item \textbf{Documentation:} There is extensive documentation 
\end{itemize}

\paragraph{Yahoo! Weather}

\begin{itemize}
  \item \textbf{Documentation:} Full documentation is available.
\end{itemize}

\paragraph{World Weather Online}

\begin{itemize}
  \item \textbf{Documentation:} Full documentation is available.
\end{itemize}

\paragraph{Google Weather Feed}

\begin{itemize}
  \item \textbf{Documentation:} No official documentation available. The inofficial documentation being available from third-party websites is sufficient for properly using Google's weather feed.
\end{itemize}

\paragraph{yr.no}

\begin{itemize}
  \item \textbf{Documentation:} Full documentation is available.
\end{itemize}

\paragraph{METAR}

\begin{itemize}
  \item \textbf{Documentation:} \emph{METAR} is well documented as it is used around the world.
\end{itemize}


\paragraph{National Weather Service}

\begin{itemize}
  \item \textbf{Documentation:} Full documentation is available.
\end{itemize}

\paragraph{Weather Underground}

\begin{itemize}
  \item \textbf{Documentation:} Full documentation is available.
\end{itemize}

\paragraph{Weather.com}

\begin{itemize}
  \item \textbf{Documentation:} Full documentation is available.
\end{itemize}

\end{comment}

\section{Conclusion}
\label{sec:weather_conclusion}

\begin{table}
  \begin{tabularx}{\textwidth}{|X|X|X|}
  \hline
  \textbf{Weather service} & \textbf{Advantage(s)} & \textbf{Disadvantage(s)} \\
  \hline \hline
  DWD & - & Data format (\eacs{SYNOP}); forecasts lack important weather elements \\
  \hline
  Yahoo! Weather & Simple data format (\eacs{RSS}) & Low number of forecasts; forecasts lack important weather elements \\
  \hline
  World Weather Online & Wide range of data formats & Free \eacs{API} lacks important data \\
  \hline
  Google Weather Feed & Simple data format (\eacs{XML}) & Unofficial, undocumented \eacs{API}; unknown terms of use; only a small number of available weather elements; discontinued \\
  \hline
  yr.no & Simple data format (\eacs{XML}); available under \emph{CC-BY 3.0}~\cite{ccby30} & - \\
  \hline
  METAR & - & Data format (\eacs{METAR}); no forecasts \\
  \hline
  National Weather Service & Simple data format (\eacs{XML}) & No worldwide coverage \\
  \hline
  Weather Underground & Data formats (\emph{XML} and \eacs{JSON}) & Public \eacs{API} lacks important data \\
  \hline
  Weather.com & Data formats (\eacs{XML} and \eacs{JSON}) & Complicated account creation \\
  \hline
  \end{tabularx}
  \caption{Advantages and disadvantages of Internet weather services}
  \label{table:weather_services}
\end{table}

Table~\ref{table:weather_services} summarizes the main advantages and disadvantages of the weather services discussed in~\ref{sec:internet_services} regarding the requirements listed there. Based on that evaluation, it is determined that \yrno clearly suits \thinkhome's requirements best. It provides current data and four forecasts per day over a period of nine days. Data is accessible in \eacs{XML} format via \eacs{HTTP} and is licensed under \emph{CC-BY 3.0}~\cite{ccby30}. Data includes details about temperature, wind direction and speed, chance and intensity of precipitation, atmospheric pressure, relative humidity, cloud coverage, and fog.

Thus, \yrno is used in chapter~\ref{ch:weather_importer} for developing the reference implementation of a program that obtains weather data for a certain location and feeds it into the \thinkhomeweather ontology. See section~\ref{sec:weather_data_yr_no} for details on how to query \yrno's weather \eacs{API}.

Nevertheless, the source of weather data shall remain replaceable. The ontology is designed in a way that makes switching to another weather service simple. If \yrno is to be replaced by another weather service, the ontology remains unchanged; only the program that imports weather data must be adapted. If the weather service used does not support one or more weather elements, they are simply omitted in the program's output.

The ontology uses these weather elements which are available from many Internet weather services and many weather sensors:
\begin{itemize}
  \item Temperature,
  \item relative humidity,
  \item dew point,
  \item cloud cover,
  \item chance and intensity of precipitation,
  \item speed and direction of wind,
  \item atmospheric pressure, and
  \item solar radiation.
\end{itemize}

Furthermore, the overall weather condition is added to the ontology. This weather condition is described by the following states: \emph{Cloudy}, \emph{fog}, \emph{light clouds}, \emph{partly cloudy}, \emph{rain}, \emph{sleet}, \emph{sun}, \emph{thunder}. At most three of them may be used together to describe the overall weather condition; two contradictory states, e.g. \emph{light clouds} and \emph{partly cloudy}, may not be used at the same time. These states are taken from the list of symbols used for describing the weather condition in the \eacs{API} of \yrno~\cite{yrno_faq}.

Additionally, the ontology supports the position of the sun. This data is not obtained from any sensor or service; a few algorithms are available available for calculating the sun's position given date, time and the geographical position (latitude and longitude); see section~\ref{sec:sun_position} for details.

To ensure the ontology can be used in the desired manner, it is necessary that the competency questions from section~\ref{sec:weather_information} can be answered by the ontology using the provided input data. See table~\ref{table:competency_questions} for details about which competency questions can be answered by using which weather element(s). Section~\ref{sec:ontology_evaluation} will discuss whether \thinkhomeweather can actually answer the competency questions.

\begin{table}
\begin{tabularx}{\textwidth}{|X|X|}
\hline
\textbf{Competency question} & \textbf{Weather element(s)} \\
\hline \hline
What is the current weather situation? & \emph{all available elements} \\
\hline
What will the weather situation be in one hour, in two hours, …, in 24 hours? & \emph{all available elements} \\
\hline
What is the current temperature, humidity, wind speed, …? & \emph{the corresponding weather element} \\
\hline
What will be the temperature, humidity, wind speed, … in one hour, in two hours, …, in 24 hours? & \emph{the corresponding weather element} \\
\hline
What will be the minimum temperature, humidity, … over the next 24 hours? What about maximum values? & \emph{the corresponding weather element} \\
\hline
Will the weather change? Will the temperature, humidity, … rise or fall? & \emph{the corresponding weather element} \\
\hline
Does it rain? Will it rain in the next hours? Will it rain today? & Precipitation \\
\hline
Will there be sunshine today? & Cloud coverage, sun radiation, sun position \\
\hline
Do we need to irrigate the garden? & Precipitation, cloud coverage, sun radiation \\
\hline
Will there be severe weather? & Wind, precipitation, temperature \\
\hline
Will temperature drop/stay below \SI{0}{\celsius}? & Temperature \\
\hline
When can we open windows and when do we have to keep them shut? & Precipitation, wind \\
\hline
When do we need sun protection? & Sun radiation, cloud coverage, sun position \\
\hline
When will it outside be colder than inside the house? When will it be warmer? & Temperature \\
\hline
\end{tabularx}
\label{table:competency_questions}
\caption{Assignment of competency questions to weather element(s)}
\end{table}

\section{Weather data}
\label{sec:weather_data_yr_no}

This section gives an overview on how requests to the weather \eacs{API} of \yrno work.

For an arbitrary request, latitude and longitude must be specified (in degrees; northern latitudes and eastern longitudes are represented by positive values)~\cite{yrno_documentation}. Additionally, the altitude above sea level (in metres) may be specified for locations outside Norway. Based on this input data, a \emph{URL} of the format

% TODO move this definition to some other position
% TODO improve formatting of lstlisting environments
\begin{lstlisting}
http://api.yr.no/weatherapi/locationforecast/1.8/?lat=<latitude>;lon=<longtude>
\end{lstlisting}

or

\begin{lstlisting}
http://api.yr.no/weatherapi/locationforecast/1.8/?lat=<latitude>;lon=<longtude>;msl=<altitude>
\end{lstlisting}

is constructed, e.g.

\begin{lstlisting}
http://api.yr.no/weatherapi/locationforecast/1.8/?lat=48.21;lon=16.37;msl=171
\end{lstlisting}

for the city of Vienna, Austria (N~\SI {48.21}{\degree }, E~\SI {16.37}{\degree }, \SI {171}{\metre } above \eacs {MSL}). An \eacs{HTTP} \emph{GET} request to this \eacs{URL} returns an \eacs{XML} document conforming to the \eacs{XML} \emph{Schema}\cite{xml-schema} definition that can be found online~\cite{yrno_schema}.

The structure of this \eacs{XML} document is as follows (attributes are omitted for better readability):

\begin{lstlisting}
<weatherdata>
	<meta>
		<model />
	</meta>
	<product>
		/* ... */
	</product>
</weatherdata>
\end{lstlisting}

The attributes of the \texttt{<model>} element describe when the forecast has been created, when it will be updated for the next time and what date and time of the first and the last forecast returned are.

There is an arbitrary number of \texttt{<time>} elements that are children of the \texttt{<product>} element. Every \texttt{<time>} element represents the weather forecast for a certain period of time. Each \texttt{<time>} element has a \texttt{<location>} element that has a child element for each weather property.

This is a typical \texttt{<time>} element:

% TODO newer content
\begin{lstlisting}
<time datatype="forecast" from="2011-10-17T09:00:00Z" to="2011-10-17T09:00:00Z">
	<location altitude="171" latitude="48.2100" longitude="16.3700">
		<temperature id="TTT" unit="celcius" value="8.5" />
		<windDirection id="dd" deg="140.3" name="SE" />
		<windSpeed id="ff" mps="4.5" beaufort="3" name="Lett bris" />
		<humidity value="45.1" unit="percent" />
		<pressure id="pr" unit="hPa" value="1027.6" />
		<cloudiness id="NN" percent="0.0" />
		<fog id="FOG" percent="0.0" />
		<lowClouds id="LOW" percent="0.0" />
		<mediumClouds id="MEDIUM" percent="0.0" />
		<highClouds id="HIGH" percent="0.0" />
	</location>
</time>
\end{lstlisting}

% TODO format names?
% TODO group names (e.g. for temperature, humidity, clouds, ...)?
The names of the elements that are allowed to be children of the \texttt{<location>} element are: \texttt{groundCover}, \texttt{pressure}, \texttt{maximumPrecipitation}, \texttt{highestTemperature}, \texttt{lowestTemperature}, \texttt{precipitation}, \texttt{fog}, \texttt{cloudiness}, \texttt{lowClouds}, \texttt{mediumClouds}, \texttt{highClouds}, \texttt{temperature}, \texttt{dewpointTemperature}, \texttt{minTemperatureDay}, \texttt{minTemperatureNight}, \texttt{maxTemperatureDay}, \texttt{maxTemperatureNight}, \texttt{uv}, \texttt{tidalwater}, \texttt{currentDirection}, \texttt{maxWaveHeight}, \texttt{surfaceTemperature}, \texttt{waveDirection}, \texttt{wavePeriod}, \texttt{waveHeight}, \texttt{humidity}, \texttt{bias}, \texttt{numberofobservations}, \texttt{meanabsoluteerror}, \texttt{score}, \texttt{windDirection}, \texttt{windSpeed}, \texttt{maxWindSpeed}, \texttt{stateOfTheSea}, \texttt{snowDepth}, \texttt{weather}, \texttt{symbol}, \texttt{forest-fire}, \texttt{windProbability}, \texttt{
temperatureProbability}, and \texttt{symbolProbability}.

None of the child elements is required. However, for most places of the world, the \eacs{XML} document contains \texttt{<location>} elements having two different sets of child elements:

\begin{itemize}
  \item Some \texttt{<location>} elements have the child elements \texttt{temperature}, \texttt{windDirection}, \texttt{windSpeed}, \texttt{humidity}, \texttt{pressure}, \texttt{cloudiness}, \texttt{fog}, \texttt{lowClouds}, \texttt{mediumClouds} and \texttt{highClouds} (as shown above). The values of the attributes from and to of the enclosing \texttt{<time>} element are equal.
  \item Some \texttt{<location>} elements have the child elements \texttt{precipitation} and \texttt{symbol}; the values of the attributes \texttt{from} and \texttt{to} of the enclosing \texttt{<time>} element differ by three to six hours; such an element looks like this:
\end{itemize}

\begin{lstlisting}
<time datatype="forecast" from="2011-10-17T03:00:00Z" to="2011-10-17T09:00:00Z">
	<location altitude="171" latitude="48.2100" longitude="16.3700">
		<precipitation unit="mm" value="0.0" />
		<symbol id="SUN" number="1" />
	</location>
</time>
\end{lstlisting}

The content of the \eacs{XML} document covers a period of nine days, starting at the current day.

\section{Position of the sun}
\label{sec:sun_position}

Besides location-based weather data, \emph{yr.no} offers an interface for retrieving sunrise and sunset data~\cite{yrno_sunrise}. Given a position in latitude and longitude together with a date, the times of rise and set of sun and moon are provided. The angle of the sun at solar noon is also given.

However, these data are inappropriate for use within the \thinkhomeweather ontology. For data about the sun's position to be of any value, it is necessary that the position is known for every \emph{Weather state}. Furthermore, most of the weather services that are available via Internet do not offer any data about the sun's position.

% TODO give informations about precision of PSA and SPA
There are some algorithms for calculating the sun's position at a certain location given by latitude and longitude at a certain time:

\begin{itemize}
  \item The \emph{SPA algorithm}\cite{SPA_algorithm} is an algorithm which is complicated to implement. Hence, it is used only in contexts where precise values are required as it yields results with uncertainties of less than \num{0.0003} degrees.
  
  \item A algorithm that can be implemented more easily is the \emph{PSA algorithm}~\cite{PSA_algorithm}. Its results differ from the actual values more than the results calculated by the \emph{SPA algorithm}. However, approximate values for the sun's position are appropriate for use in the \thinkhomeweather ontology. Hence, the \emph{PSA algorithm} is suitable for use by the \emph{Weather importer} application (see section~\ref{subsec:importer_fetch}). A ready-to-use implementation of the \emph{PSA algorithm} in C++ is available; this implementation can easily be ported to Java.
\end{itemize}
