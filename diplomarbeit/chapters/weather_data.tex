% TODO aim of this chapter: find out which data is available, where can they be obtained, which values are useful

% TODO some section containing thoughts about which data is required for the ThinkHome ontology, e.g. in the chapter about the ontology itself?

Based on the insights acquired from existing work in chapter \ref{ch:existing_work}, this chapter aims at compiling a set of weather properties which are either necessary for providing useful data to the \thinkhome system or which would add benefit to the data provided. Furthermore, possible sources will are evaluated with respect to their usableness in the given context.

\section{Weather information}

% TODO reference competence questions
In order to identify weather properties required for \thinkhome, one must specify the requirements that have to be met. When designing an ontology, this is often done by asking numerous \emph{competence questions}.

These competence questions that shall be answered by \thinkhome's weather ontology:

% TODO answer: where do 24 hours come from? discuss questions further? how were these questions built?
\begin{itemize}
  \item What is the current weather situation?
  \item What will the weather situation be in one hour, in two hours, …, in 24 hours?
  \item What is the current temperature, humidity, wind speed, …?
  \item What will be the temperature, humidity, wind speed, … in one hour, in two hours, …, in 24 hours?
  \item What will be the minimum temperature, humidity, … over the next 24 hours? What about maximum values?
  \item Will the weather change? Will the temperature, humidity, … rise or fall?
  \item Does it rain? Will it rain in the next hours? Will it rain today?
  \item Will there be sunshine today? 
  \item Do we need to irrigate the garden?
  \item Will there be severe weather?
  \item Will temperature drop/stay below $0^\circ C$?
  \item When can we open windows and when do we have to keep them shut?
  \item When do we need sun protection?
  \item When will it outside be colder than inside the house? When will it be warmer?
\end{itemize}

These competence questions will again be used in section \label{sec:ontology_specification} for creating the \emph{Ontology requirements specification document}.

% TODO references
% TODO measurement readings
These questions can be answered when knowing the (predicted) state of the weather for particular points of time. The state of the weather is given by measurement readings of certain \emph{weather elements}. These weather elements are temperature, relative and absolute humidity, dew point temperature, wind speed, wind direction, precipitation, cloud coverage etc.

A set of measurement readings for one or more points of time is called \emph{weather data} from now on.

Sources for weather data are weather sensors and weather forecasts. As no weather forecasting is performed within \thinkhome, forecast data will be obtained from weather services via Internet. Data about the current weather state can be obtained from both weather sensors and Internet services; the only source for data about future weather states are Internet services.

However, there there are weather elements no sensor can provide data about, and there are weather elements that are not available via any of the Internet services that have been analyzed. Chapter \ref{sec:weather_sensors} covers everything that can be obtained from weather sensors, and chapter \ref{sec:weather_services} discusses weather data that can be fetched from Internet services. Based on the findings within these two chapters, \ref{sec:weather_conclusion} presents a set of weather elements that are incorporated into the ontology that is developed in chapter \ref{ch:thinkhomeweather_ontology}.

\section{Sensor data}
\label{sec:weather_sensors}

\subsection{KNX weather stations}

\section{Service data}
\label{sec:weather_services}

% TODO blah blah

\subsection{Available Internet services}

There is a tremendous amount of services providing weather data over the Internet. However, only a small number of them is suitable for use in a context as in \thinkhome. The services differ regarding the way data is provided, the data format, the area being covered, the terms of use etc.

For evaluation of Internet weather services, the following aspects are examined:

\begin{itemize}
  \item \textbf{Coverage area:} Which part of the world is covered by the weather service?\\
  In order to keep things simple, a service covering a larger part of the world is preferred over a service covering a smaller part.
  \item \textbf{Data format:} In what format is weather data being delivered? Can it be easily parsed and processed?\\
  A data format that is easier to handle on the client-side is preferred over a data format that requires more complicated handling.
  \item \textbf{Data access:} How does the access to weather data work? How is data requested and how is the answer being received?\\
  The less complicated a request is, the better the service suits the requirements.
  \item \textbf{Access restrictions, terms of use:} Is the service available freely or is the access restricted? Are credentials (e.g. a username and a password or an access key) required for access? If yes, can the credentials be obtained in a simple way or does that entail a complicated procedure? Are there any access fees for academic or commercial use?\\
  A service being less restricted is preferred over a service coming with more restrictions.
  \item \textbf{Documentation:} Is there any documentation for this service? Does it cover all aspects or are there some features that are undocumented?\\
  Of course, a service without documentation is unsuitable. A better documented service is always preferred over a service that is less documented.
  \item \textbf{Stability:} Can one expect the service to remain unchanged over a reasonable amount of time (e.g. several years)? If there will be future changes, will they be announced? How long will they be announced in advance?\\
  A stable service is preferred over an unstable one. A better handling of changes is preferred over a worse handling of changes.
  \item \textbf{Weather elements:} Which weather elements (e.g. temperature, relative humidity, dew point etc.) are covered by the service?\\
  A weather service covering a wider range of weather elements is preferred over a service covering a smaller range.
  \item \textbf{Timeframe:} Are forecasts available? If yes, how detailled are these forecasts? How far into the future are forecasts available? What is the interval between two forecasts?\\
  Forecasts for at least 48 hours are mandatory. Over the next 48 hours, there should be at least six forecasts with an interval of at most eight hours between two consecutive forecasts. A weather service covering a longer period than 48 hours into the future and/or more than six forecasts within the next 48 hours is preferred.
  \item \textbf{Weather updates:} How often is the weather data being updated?\\
  The data should be updated at least every six hours. A service having a shorter update interval is preferred over a service having a longer interval.
\end{itemize}

In the following sections, some of the most popular Internet weather services are evaluated. In addition to the aspects listed above, some general information is provided (operator, web page and ...). % TODO

% TODO conclusion for every service?

\paragraph{DWD}

\begin{itemize}
  \item \textbf{Operator:} \emph{Deutscher Wetterdienst} (\emph{DWD}, ``German weather service'')
  \item \textbf{Web page:} \href{http://www.dwd.de/}{http://www.dwd.de/}
  \item \textbf{Coverage area:} Current weather data is available worldwide, forecasts are available within Germany and only for large cities outside Germany.
  \item \textbf{Data format:} Current weather data is available in SYNOP format (Surface Synoptic Observations) \footnote{\href{http://weather.unisys.com/wxp/Appendices/Formats/SYNOP.html}{http://weather.unisys.com/wxp/Appendices/Formats/SYNOP.html}}. A Java parser may be difficult to implement. Forecasts are available as weather maps, tables and text (not machine-readable).
  \item \textbf{Data access:} Via FTP (supported by the Apache HttpComponents project\footnote{\href{http://hc.apache.org/}{http://hc.apache.org/}}).
  \item \textbf{Access restrictions, terms of use:} An account is mandatory for access. Account creation is a matter of minutes and new accounts do not need to be approved by DWD. The use of DWD is free for use within projects like \thinkhome.
  \item \textbf{Documentation:} There is extensive documentation 
  \item \textbf{Stability:} Every few weeks there are a few changes to the data format. However, data required by \thinkhome has never been changed during the last six months. Changes are announced via email at least one week in advance.
  \item \textbf{Weather elements:} Temperature, relative humidity, wind speed and direction, precipitation, atmospheric pressure, cloud coverage. Forecasts only include temperature and the overall weather condition.
  \item \textbf{Timeframe:} Forecasts are available for 72 hours into the future.
  \item \textbf{Weather updates:} Weather data is updated every few hours.
\end{itemize}

\paragraph{Yahoo! Weather}

\begin{itemize}
  \item \textbf{Operator:} \emph{Yahoo! Inc.}
  \item \textbf{Web page:} \href{http://developer.yahoo.com/weather/}{http://developer.yahoo.com/weather/}
  \item \textbf{Coverage area:} Worldwide coverage.
  \item \textbf{Data format:} RSS feed.
  \item \textbf{Data access:} Via HTTP.
  \item \textbf{Access restrictions, terms of use:} Free for use for individuals and non-profit organizations, providing attribution required. No statement about commercial use anywhere in the documentation.
  \item \textbf{Documentation:} Full documentation is available.
  \item \textbf{Stability:} It is unknown whether this API is subject to change or not.
  \item \textbf{Weather elements:} Temperature, wind chill, speed and direction, relative humidity, visibility, atmospheric pressure, sunrise and sunset times.
  \item \textbf{Timeframe:} Forecasts are available for 48 hours, but only one forecast per day.
  \item \textbf{Weather updates:} Weather data is updated every few hours.
\end{itemize}

\paragraph{World Weather Online}

\begin{itemize}
  \item \textbf{Operator:} World Weather Online
  \item \textbf{Web page:} \href{http://www.worldweatheronline.com}{http://www.worldweatheronline.com}
  \item \textbf{Coverage area:} Worldwide coverage.
  \item \textbf{Data format:} Data is available in XML, JSON, JSON-P and CSV formats.
  \item \textbf{Data access:} Via HTTP.
  \item \textbf{Access restrictions, terms of use:} An account must be created for accessing both the Free API and the Premium API. The Free API is free to use for personal and commercial use, credits must be given to World Weather Online. Costs for the Premium API start at 20 US dollars per month.
  \item \textbf{Documentation:} Full documentation is available.
  \item \textbf{Stability:} It is unknown whether the APIs are subject to change or not.
  \item \textbf{Weather elements:} Free API offers temperature, wind speed and direction, relative humidity and precipitation intensity. Premium API additionally offers dew point, chance of precipitation and atmospheric pressure.
  \item \textbf{Timeframe:} The Free API offers daily forecasts over a range of five days, the Premium API comes with 
  \item \textbf{Weather updates:} Weather data is updated every 3 to 4 hours.
\end{itemize}

\paragraph{Google Weather Feed}

\begin{itemize}
  \item \textbf{Operator:} Google Inc.
  \item \textbf{Web page:} As Google's weather feed is not a publicly advertised API, there is no web page for it.
  \item \textbf{Coverage area:} Worldwide coverage.
  \item \textbf{Data format:} XML feed.
  \item \textbf{Data access:} Via HTTP.
  \item \textbf{Access restrictions, terms of use:} There is no explicit licence for this API as it is an inofficial interface. Hence, usage of this API within any project is probably not allowed at all.
  \item \textbf{Documentation:} No official documentation available. The inofficial documentation being available from third-party websites is sufficient for properly using Google's weather feed.
  \item \textbf{Stability:} It is unknown whether the API is subject to change or not. It must be expected that it may be changed without prior notice.
  \item \textbf{Weather elements:} Temperature, humidity (not included in forecasts) and the overall weather condition.
  \item \textbf{Timeframe:} Daily forecasts are available over the next 72 hours.
  \item \textbf{Weather updates:} Weather data is updated every few hours.
\end{itemize}

\paragraph{yr.no}

\begin{itemize}
  \item \textbf{Operator:} Meteorologisk institutt (Norwegian Meteorological Institute), Norsk rikskringkasting AS (NRK, Norwegian Broadcasting Corporation)
  \item \textbf{Web page:} \href{http://api.yr.no/}{http://api.yr.no/}
  \item \textbf{Coverage area:} Worldwide.
  \item \textbf{Data format:} XML.
  \item \textbf{Data access:} Via HTTP.
  \item \textbf{Access restrictions, terms of use:} Data is available under a Creative Commons licence (CC-BY 3.0\footnote{\href{http://creativecommons.org/licenses/by/3.0}{http://creativecommons.org/licenses/by/3.0}})
  \item \textbf{Documentation:} Full documentation is available.
  \item \textbf{Stability:} There are new releases of the API one or two times per year. The old API remains in operation a few months after a new version has been released. New releases are announced on the web page of the API.\\
  Additionally, there is a \emph{long time support} weather API that changes less frequent.
  \item \textbf{Weather elements:} Temperature, wind direction and speed, chance and intensity of precipitation, atmospheric pressure, relative humidity, cloud coverage, fog.
  \item \textbf{Timeframe:} Forecasts for nine days in advance, interval of six hours between two forecasts.
  \item \textbf{Weather updates:} Weather data is updated every few hours.
\end{itemize}

\paragraph{METAR}

\begin{itemize}
  \item \textbf{Operator:}
  \item \textbf{Web page:}
  \item \textbf{Coverage area:}
  \item \textbf{Data format:}
  \item \textbf{Data access:}
  \item \textbf{Access restrictions, terms of use:}
  \item \textbf{Documentation:}
  \item \textbf{Stability:}
  \item \textbf{Weather elements:}
  \item \textbf{Timeframe:}
  \item \textbf{Weather updates:}
\end{itemize}

\paragraph{National Weather Service}

\begin{itemize}
  \item \textbf{Operator:}
  \item \textbf{Web page:}
  \item \textbf{Coverage area:}
  \item \textbf{Data format:}
  \item \textbf{Data access:}
  \item \textbf{Access restrictions, terms of use:}
  \item \textbf{Documentation:}
  \item \textbf{Stability:}
  \item \textbf{Weather elements:}
  \item \textbf{Timeframe:}
  \item \textbf{Weather updates:}
\end{itemize}

\paragraph{Weather Underground}

\begin{itemize}
  \item \textbf{Operator:}
  \item \textbf{Web page:}
  \item \textbf{Coverage area:}
  \item \textbf{Data format:}
  \item \textbf{Data access:}
  \item \textbf{Access restrictions, terms of use:}
  \item \textbf{Documentation:}
  \item \textbf{Stability:}
  \item \textbf{Weather elements:}
  \item \textbf{Timeframe:}
  \item \textbf{Weather updates:}
\end{itemize}

\paragraph{Weather.com}

\begin{itemize}
  \item \textbf{Operator:}
  \item \textbf{Web page:}
  \item \textbf{Coverage area:}
  \item \textbf{Data format:}
  \item \textbf{Data access:}
  \item \textbf{Access restrictions, terms of use:}
  \item \textbf{Documentation:}
  \item \textbf{Stability:}
  \item \textbf{Weather elements:}
  \item \textbf{Timeframe:}
  \item \textbf{Weather updates:}
\end{itemize}

\section{Conclusion}
\label{sec:weather_conclusion}

Among the weather services that have been evaluated, \emph{yr.no} suits \thinkhome's requirements best. Therefore, it is used for developing a program that obtains weather data for a certain location and feeds it into the \thinkhomeweather ontology that is developed in section \ref{sec:ontology_specification}. See section \ref{subsec:weather_data_yr_no} for details on how to query \emph{yr.no}'s weather API.

However, the weather service shall be replaceable. The ontology is designed in a way that makes switching to another weather service simple. If \emph{yr.no} is to be replaced by another weather service, the ontology remains unchanged, but a new program for importing weather data into the ontology must be developed.

The ontology uses these weather elements which are available from most Internet weather services and many weather sensors:
\begin{itemize}
  \item Temperature,
  \item relative humidity,
  \item dew point,
  \item cloud cover,
  \item chance and intensity of precipitation,
  \item speed and direction of window,
  \item atmospheric pressure, and
  \item solar radiation.
\end{itemize}

% TODO weather condition

Additionally, the ontology also supports the position of the sun. However, it is not necessary to obtain the sun's position from an internet service as there are a few algorithms available for calculating the sun's position given date, time and the geographical position (latitude and longitude); see \ref{subsec:sun_position} for details.

